<!DOCTYPE html>
<html lang="es">
<head>
    <%- include('../partials/head') %>
</head>
<body>
    <%- include('../partials/navbar') %>

    <div class="container">
        <div class="page-header">
            <h2><i class="fas fa-calendar-check"></i> Detalle de Cita</h2>
            <div>
                <a href="/citas/lista" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Volver
                </a>
                <a href="/citas/dia" class="btn btn-primary">
                    <i class="fas fa-calendar-day"></i> Citas del Día
                </a>
            </div>
        </div>

        <div class="form-card">
            <h3><i class="fas fa-calendar"></i> Información de la Cita</h3>
            
            <div style="margin: 20px 0;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>Fecha:</strong> <%= new Date(cita.fecha).toLocaleDateString('es-CO', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>Hora:</strong> <%= cita.hora %>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>Estado:</strong> 
                    <span class="status-badge status-<%= cita.estado %>">
                        <%= cita.estado %>
                    </span>
                </div>
            </div>

            <h3><i class="fas fa-user"></i> Información del Paciente</h3>
            <div style="margin: 20px 0;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>Nombre:</strong> <%= cita.paciente.nombreCompleto %>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>Documento:</strong> <%= cita.paciente.tipoDocumento %>-<%= cita.paciente.numeroDocumento %>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>Teléfono:</strong> <%= cita.paciente.telefono %>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>Edad:</strong> <%= cita.paciente.edad %> años
                </div>
            </div>

            <h3><i class="fas fa-user-md"></i> Personal Asistencial</h3>
            <div style="margin: 20px 0;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>Médico/Personal:</strong> <%= cita.medicoAsignado.nombre %>
                </div>
                <% if (cita.usuarioCreador) { %>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>Registrado por:</strong> <%= cita.usuarioCreador.nombre %>
                </div>
                <% } %>
            </div>

            <h3><i class="fas fa-notes-medical"></i> Motivo de Consulta</h3>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <%= cita.motivoConsulta %>
            </div>

            <% if (cita.estado === 'pendiente') { %>
                <div class="form-actions" style="margin-top: 30px;">
                    <form action="/citas/<%= cita._id %>/estado" method="POST" style="display: inline;">
                        <input type="hidden" name="estado" value="atendida">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-check"></i> Marcar como Atendida
                        </button>
                    </form>
                    <form action="/citas/<%= cita._id %>/estado" method="POST" style="display: inline;">
                        <input type="hidden" name="estado" value="cancelada">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-times"></i> Cancelar Cita
                        </button>
                    </form>
                </div>
            <% } %>
        </div>
    </div>
</body>
</html>